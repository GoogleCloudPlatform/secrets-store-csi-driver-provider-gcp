timeout: 600s
options:
  machineType: N1_HIGHCPU_8
steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '.',
       '--build-arg', 'SECRET_STORE_VERSION=$_SECRET_STORE_VERSION',
       '--build-arg', 'GCP_PROVIDER_SHA=$_GCP_PROVIDER_SHA',
       '-t', 'gcr.io/$PROJECT_ID/e2e-test:$_GCP_PROVIDER_SHA']
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', './test-secret-mounter',
       '-t', 'gcr.io/$PROJECT_ID/test-secret-mounter:$_GCP_PROVIDER_SHA']
substitutions:
  _SECRET_STORE_VERSION: ""
  _GCP_PROVIDER_SHA: ""
images:
- 'gcr.io/$PROJECT_ID/e2e-test:$_GCP_PROVIDER_SHA'
- 'gcr.io/$PROJECT_ID/test-secret-mounter:$_GCP_PROVIDER_SHA'
