apiVersion: iam.cnrm.cloud.google.com/v1beta1
kind: IAMPolicy
metadata:
  name: iam-policy
spec:
  resourceRef:
    apiVersion: resourcemanager.cnrm.cloud.google.com/v1beta1
    kind: Project
    external: projects/test-csi-test-infra
  bindings:
    # to manage test clusters
    - members:
      - serviceAccount:e2e-test-sa@test-csi-test-infra.iam.gserviceaccount.com
      role: roles/container.admin
    - members:
      - serviceAccount:cnrm-system@test-csi-test-infra.iam.gserviceaccount.com
      role: roles/owner
    - members:
      - user:colinman@google.com
      role: roles/owner
    - members:
      - serviceAccount:service-1012695704554@container-engine-robot.iam.gserviceaccount.com
      role: roles/container.serviceAgent
    - members:
      - serviceAccount:1012695704554-compute@developer.gserviceaccount.com
      role: roles/compute.serviceAgent
      # to pull GCR images (TODO: reduce scope)
    - members:
      - serviceAccount:1012695704554-compute@developer.gserviceaccount.com
      role: roles/editor
    - members:
      - serviceAccount:1012695704554@cloudservices.gserviceaccount.com
      role: roles/editor
    # for e2e test to access secrets
    - members:
      - serviceAccount:test-csi-test-infra.svc.id.goog[default/test-cluster-sa]
      role: roles/secretmanager.secretAccessor
    - members:
      - serviceAccount:e2e-test-sa@test-csi-test-infra.iam.gserviceaccount.com
      role: roles/secretmanager.admin
